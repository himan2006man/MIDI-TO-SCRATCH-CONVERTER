# MIDI to Scratch Converter

A Python tool that converts MIDI files into a Scratch-compatible format, enabling you to play real MIDI files with polyphony, instrument changes, and tempo shifts directly in Scratch.

## Features

### Python Converter
- Drag-and-drop GUI for easy file selection
- Converts MIDI notes, instruments, and tempo changes
- Groups simultaneous notes into chords
- Outputs a readable .txt file for Scratch to parse
- Supports complex rhythms including triplets, dotted notes, and subdivisions down to 64th notes
- Maps General MIDI's 128 instruments to Scratch's 21 instruments

### Scratch Player
- Reads the converted file and plays notes using Scratch's sound engine
- Supports multiple instruments and dynamic tempo changes
- Handles polyphonic playback (chords)
- Designed for expressive playback with visual feedback
- Self-contained in a single sprite for easy backpacking and reuse

## Requirements

- Python 3.7 or higher
- `mido` library for MIDI file parsing

## Installation

1. Clone this repository or download the Python file
2. Install the required library:
```bash
pip install mido
```

## Usage

### Running the Converter

**With GUI (Recommended):**
```bash
python midi_to_scratch_gui.py
```

1. Click "Browse" to select your MIDI file
2. Click "Convert to Scratch Format"
3. The converter will create a .txt file in the same location as your MIDI file

**From Command Line:**
If you prefer command-line usage, the converter can be run with:
```bash
python midi_to_scratch_gui.py
```
Then use the GUI that appears.

### Using in Scratch

1. Open the Scratch MIDI Player project (link in description)
2. Create a list called "midi" (or import the sprite with the list already created)
3. Right-click the list and select "Import"
4. Choose the .txt file generated by the converter
5. Click the green flag to play

**Note:** For best results, use TurboWarp at 250 FPS with turbo mode enabled. Regular Scratch runs at 30 FPS which may cause timing issues with fast songs.

## Output Format

The converter creates a text file with the following format:

```
Instr: 1
BPM: 120
Note: 60~64~67
Rest: 0.5
Note: 62~65~69
Rest: 1
BPM: 140
Note: 64
Rest: 0.25
```

- `Instr: [number]` - Sets the instrument (1-21)
- `BPM: [number]` - Sets the tempo in beats per minute
- `Note: [numbers]` - MIDI note numbers, separated by `~` for chords
- `Rest: [number]` - Rest duration in beats

## Supported Note Durations

The converter intelligently rounds MIDI timings to musical note values:

- 64th notes (0.0625)
- 32nd notes (0.125)
- Triplet 16th notes (0.166)
- 16th notes (0.25)
- Triplet 8th notes (0.33)
- 8th notes (0.5)
- Dotted 8th notes (0.75)
- Quarter notes (1)
- Dotted quarter notes (1.5)
- Half notes (2)
- Dotted half notes (3)
- Whole notes (4)
- And longer durations up to quadruple whole notes (16)

## Technical Details

### Chord Detection
Notes played within 1/32nd of a beat are grouped together as chords. This accounts for slight timing variations in MIDI files where notes meant to be simultaneous are slightly offset.

### Instrument Mapping
General MIDI's 128 instruments are intelligently mapped to Scratch's 21 instruments based on instrument families (strings, brass, woodwinds, etc.).

### Timing Precision
The converter preserves MIDI timing information and converts it to beat-based durations. Large MIDI files may take some time to process.

## Known Limitations

- Scratch's "play note" block is blocking, making true simultaneous chord playback challenging
- Very fast passages (180+ notes per second) require TurboWarp with high FPS settings
- Percussion/drums on MIDI channel 10 are converted but may not sound authentic in Scratch
- Very large MIDI files (thousands of notes) may take time to convert

## Tips for Best Results

- Use TurboWarp instead of regular Scratch for better performance
- Enable turbo mode and set FPS to 250 for accurate timing
- Simpler MIDI files with fewer simultaneous notes will play more accurately
- Test your converted file with a short section first before playing the entire piece

## Contributing

Feedback and suggestions for improvement are welcome. If you encounter issues with specific MIDI files or have ideas for new features, please open an issue.

## License

This project is provided as-is for educational and creative purposes.

## Links

Scratch MIDI Player Project: (https://scratch.mit.edu/projects/1275189900)
TurboWarp Version: (https://turbowarp.org/1275189900?fps=250&interpolate&stuck&limitless)

## Credits

Created for the Scratch community to enable MIDI playback in projects.
